your app on all linuxes
Like me, you're probably thinking <i>whyyy do i gotta learn this dumb thing</i>?
 But until distros use flatpak, there's no choice.

FlatPak is <i>well</i> designed and well documented on
<a pop href="https://docs.flatpak.org/en/latest/">flatpak.org</a>.
 Lemme summarize it first.

And
 <a pop href="https://flathub.org/en?category=popular">flathub.org</a>
 is how you distribute your app.  It has picky requirements we'll get to.

End users actually install with a search and click in
 - KDE's discover app

 - gnome's software app


<h3>flatpak's main deal</h3>
 is that your app links to a standard set of shared libs provided
 by a <b>flatpak runtime</b> -
 a <i>standardized, versioned</i> set of shared libs.
 You'll pick kde/gnome (Qt/GTK) and which version.


<h3>your app triplet</h3>
 app names must not conflict - via an annoying reverse URL setup.
 My website is https://shaz.app and my app is pianocheetah so it must be named
 - app.shaz.pianocheetah

Not great.  But, eh, not terrible.


<h3>permissions</h3>
 Flatpak executables run in a sandbox.
 The idea is to protect users from malicious apps.

I don't understand that.  If you don't trust it, why is it there??
 Expecting permissions to prevent malicious apps is illogical.

In the end, your app must specify lots of permissions that all apps need.
 Yes my app uses graphics.  Why?  How could it not?  Come on flatpak.


<h3>special directories</h3>
 The sandbox gives your app standard "virtual" directories - all to itself.
 Executables are at:

 - /app/bin/<i>whatev_app</i>

And your config files are at:

 - /var/config/<i>whatev.conf</i>

These files are persisted in the user's home dir at:

 - /home/user/.var/app/app-triplet/<i>etc-etc-etc</i>

You can enter the sandbox to list and run stuff:

 - flatpak run --command=sh app.shaz.pianocheetah

<pre>
 [app.shaz.pianocheetah app]$ cd /app/bin
 [app.shaz.pianocheetah bin]$ ls -al
 total 2128
 drwxr-xr-x 2 nfsnobody nfsnobody   4096 Dec 31  1969 .
 drwxr-xr-x 4 nfsnobody nfsnobody   4096 Oct 26 17:09 ..
 -rwxr-xr-x 2 nfsnobody nfsnobody 142640 Dec 31  1969 initme
 -rwxr-xr-x 2 nfsnobody nfsnobody  59584 Dec 31  1969 ll
 -rwxr-xr-x 2 nfsnobody nfsnobody 137248 Dec 31  1969 mid2song
 -rwxr-xr-x 2 nfsnobody nfsnobody 217504 Dec 31  1969 midicfg
 -rwxr-xr-x 2 nfsnobody nfsnobody  51288 Dec 31  1969 midimp
 -rwxr-xr-x 2 nfsnobody nfsnobody 101840 Dec 31  1969 mod2song
 -rwxr-xr-x 2 nfsnobody nfsnobody 947936 Dec 31  1969 pianocheetah
 -rwxr-xr-x 2 nfsnobody nfsnobody 118496 Dec 31  1969 sfz2syn
 -rwxr-xr-x 2 nfsnobody nfsnobody 171584 Dec 31  1969 song2wav
 -rwxr-xr-x 2 nfsnobody nfsnobody  97712 Dec 31  1969 synsnd
 -rwxr-xr-x 2 nfsnobody nfsnobody 110016 Dec 31  1969 txt2song
 [app.shaz.pianocheetah app]$ cd /var/config
 ...etc etc </pre>
These directory paths only exist while the flatpak exes run.
 This will mean a minor rewrite to some of your code.
 If you start other executables that are part of the flatpak,
 you'll need to system() them in
 - /app/bin/whatever_exe

And when you write config files, them <i>must</i> be like
 - /var/config/my_conf.conf


<h3>Let's git started</h3>
 First thing is your <b>manifest</b>.  A json file that specs:
 - app triplet

 - which flatpak runtime (kde/gnome and which version)

 - your app permissions can't just be "default" sigh.

Here's <a pop href='fpak.html'>mine</a>.  I use c++ and qt6.
 My app is currently named app.pianocheetah.pianocheetah :/  Till I rename it.


<h3>permissions</h3>
 are in finish-args.  They'll be the same for every app.
 - except no need for --socket=pulseaudio if you're not using audio

 - filesystem=home is preferred by flathub admins.  But in practice this will
   turn paths in your home dir into some pretty terrible softlinks
   that I don't want to deal with or have my users see.  My preference is
   filesystem=host (gimme every file).


<h3>building</h3>
 I have a common set of include files in a dir called "stv".
 Qt uses a cmake-ninja which uses CMakeList.txt - your make file.

The first "module" is my .desktop and icon files.
 and an "appdata" file about my program with screenshots, etc.
 The flatpak docs explain that gory stuff.

That's all the explanation you get - sorry.

The main docs are good, but skimpy.

My script to actually run the build (please excuse my php)
is <a pop href="b">here</a>

<h3>build dirs</h3>
Ok that build script looked a little ugly (i mean, it is php).
Let's talk about the flatpak build and release process.

 - build dir - this is where flatpak-builder
   (which you'll need to apt install) writes your executables, etc.

 - repo dir - this is a dir you can distribute/install your app from.
   It might be an actual git repo.  Not sure :/

 - .flatpak-builder - a cache dir holding previous builds -
   I usually just wipe it.

<h3>distribute manifest</h3>
Here's my distribute manifest - much simpler :)
<a pop href="app.pianocheetah.pianocheetah.json">here</a>.

And my build script can be given an o argument to stop
 upon making the build diretory for flathub.
 Then I make a pull request on flathub's repo and
 add my build dir and the release manifest.

All the release manifest does is take the binaries and
 desktop/icon/appdata and put em in a flatpak repo.
 Then upon the flathub guys doin' their thing, it shows up on flathub :)

Ok!

One last problem flatpak has is
 - how do I run flatpaks from the command line ???

I got your answer...
